insert into QCSAMPLE.SAMPLE
(
SAMPLE_IID,
SAMPLE_ID,
MASTER_LOT_IID,
ORIGINAL_SAMPLE_IND,
SHIPPING_LABEL_ID,
SAMPLE_TYPE_CDE,
SAMPLE_CATEGORY_CDE,
SAMPLE_STATUS_CDE,
SAMPLE_COLL_MEDIUM_CDE,
SAMPLE_CREATION_DTE,
LAB_RECEIVED_DTE,
SAMPLE_EXTRACTED_DTE,
SAMPLE_POOLED_DTE,
EXPIRATION_DTE,
STORAGE_ENVIRON_NME,
STORAGE_UNIT_NME,
SHELF_NUM,
BOX_NUM,
SLOT_LOCATION_NME,
SAMPLE_UNIT_VOL,
SAMPLE_UNIT_UOM,
SAMPLES_STORED_QTY,
SAMPLE_STORED_QTY_UOM,
CONCENTRATION_QTY,
CONCENTRATION_QTY_UOM,
SAMPLE_LABELED_BY,
COMMENT_TXT,
CREATE_TS,
CREATE_BY_ID,
UPDATE_TS,
UPDATE_BY_ID
)
select /*+ LEADING(e ss)*/
QCSAMPLE.SEQ_SAMPLE.NEXTVAL,
ml.MASTER_LOT_ID || '.' || lpad(ROW_NUMBER() OVER (PARTITION BY qcdid.QC_DID ORDER BY qcdid.NMDP_DID) + ml.ORIGINAL_QTY,6,'0') || 'J' as SAMPLE_ID,
ml.MASTER_LOT_IID,
'N' as ORIGINAL_SAMPLE_IND,
qcdid.NMDP_DID as SHIPPING_LABEL_ID,
e.SEND_TYPE as SAMPLE_TYPE_CDE,
'QC' as SAMPLE_CATEGORY_CDE,
case when nvl(qcdid.CNT_HIST, 0) = 0 then 'ACTIVE' else 'DEPLETED' end as SAMPLE_STATUS_CDE,
e.SEND_MEDIUM as SAMPLE_COLL_MEDIUM_CDE,
SWAB_CREATION_DATE as SAMPLE_CREATION_DTE,
null as LAB_RECEIVED_DTE,
null as SAMPLE_EXTRACTED_DTE,
null as SAMPLE_POOLED_DTE,
SWAP_EXPIRATION_DATE as EXPIRATION_DTE,
'Room Temperature' as STORAGE_ENVIRON_NME, 
'QC Unit' as STORAGE_UNIT_NME,
null as SHELF_NUM,
null as BOX_NUM,
null as SLOT_LOCATION_NME,
150 as SAMPLE_UNIT_VOL,
'µL' as SAMPLE_UNIT_UOM,
case when nvl(qcdid.CNT_HIST, 0) = 0 then 1 else null end as SAMPLES_STORED_QTY,
case when nvl(qcdid.CNT_HIST, 0) = 0 then 'unit' else null end as SAMPLE_STORED_QTY_UOM,
2 as CONCENTRATION_QTY,
'ng/µL' as CONCENTRATION_QTY_UOM,
null as SAMPLE_LABELED_BY,
null as COMMENT_TXT,
SYSTIMESTAMP as CREATE_TS,
'BODS_LOAD' as CREATE_BY_ID,
SYSTIMESTAMP as UPDATE_TS,
'BODS_LOAD' as UPDATE_BY_ID
from ETL_STAGE.QCSAMPLE_INV_EXCEL_DNA e
inner join QCSAMPLE.SAMPLE_SOURCE ss on 'QC_DRIVE' || nvl(cast(e.SAMPLE_ID as number(9)), e.QC_MASTER_LOT_ID) = ss.SAMPLE_SOURCE_ID
inner join QCSAMPLE.MASTER_LOT ml on ml.SAMPLE_SOURCE_IID = ss.SAMPLE_SOURCE_IID and lpad(e.QC_MASTER_LOT_ID, 6, '0') = ml.MASTER_LOT_ID
inner join ( 
	select QC_DID, NMDP_DID, CNT_HIST, LST_UPDT_DTE
	from ETL_STAGE.QCSAMPLE_INV_SYBASE_QC_DID
	union all
	select QC_DID, NMDP_DID, CNT_HIST, LST_UPDT_DTE
	from ETL_STAGE.QCSAMPLE_INV_SYBASE_QC_DID
)qcdid on trim(qcdid.QC_DID) = 'QC' || case when length(trim(e.QC_MASTER_LOT_ID)) <3 then lpad(trim(e.QC_MASTER_LOT_ID),3,'0') else cast(trim(e.QC_MASTER_LOT_ID) as varchar2(50)) end
where e.Active = 1;

commit;
