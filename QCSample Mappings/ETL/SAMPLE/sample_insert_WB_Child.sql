insert into QCSAMPLE.SAMPLE
(
SAMPLE_IID,
SAMPLE_ID,
MASTER_LOT_IID,
ORIGINAL_SAMPLE_IND,
SHIPPING_LABEL_ID,
SAMPLE_TYPE_CDE,
SAMPLE_CATEGORY_CDE,
SAMPLE_STATUS_CDE,
SAMPLE_COLL_MEDIUM_CDE,
SAMPLE_CREATION_DTE,
LAB_RECEIVED_DTE,
SAMPLE_EXTRACTED_DTE,
SAMPLE_POOLED_DTE,
EXPIRATION_DTE,
STORAGE_ENVIRON_NME,
STORAGE_UNIT_NME,
SHELF_NUM,
BOX_NUM,
SLOT_LOCATION_NME,
SAMPLE_UNIT_VOL,
SAMPLE_UNIT_UOM,
SAMPLES_STORED_QTY,
SAMPLE_STORED_QTY_UOM,
CONCENTRATION_QTY,
CONCENTRATION_QTY_UOM,
SAMPLE_LABELED_BY,
COMMENT_TXT,
CREATE_TS,
CREATE_BY_ID,
UPDATE_TS,
UPDATE_BY_ID
)
select /*+ NO_USE_NL(e ss ml qcdid) */
QCSAMPLE.SEQ_SAMPLE.NEXTVAL,
ml.MASTER_LOT_ID || '.' || lpad(ROW_NUMBER() OVER (PARTITION BY qcdid.QC_DID ORDER BY qcdid.NMDP_DID) + e.VIALS_LEFT,6,'0') || 'W' as SAMPLE_ID,
ml.MASTER_LOT_IID,
'N' as ORIGINAL_SAMPLE_IND,
qcdid.NMDP_DID as SHIPPING_LABEL_ID,
e.SEND_TYPE as SAMPLE_TYPE_CDE,
'QC' as SAMPLE_CATEGORY_CDE,
case when nvl(qcdid.CNT_HIST, 0) = 0 then 'ACTIVE' else 'DEPLETED' end as SAMPLE_STATUS_CDE,
e.SEND_MEDIUM as SAMPLE_COLL_MEDIUM_CDE,
e.DATE_CREATED as SAMPLE_CREATION_DTE,
null as LAB_RECEIVED_DTE,
null as SAMPLE_EXTRACTED_DTE,
null as SAMPLE_POOLED_DTE,
null as EXPIRATION_DTE,
'Room Temperature' as STORAGE_ENVIRON_NME, 
'QC Unit' as STORAGE_UNIT_NME,
null as SHELF_NUM,
null as BOX_NUM,
null as SLOT_LOCATION_NME,
e.VOL_FOR_FP as SAMPLE_UNIT_VOL,
'µL' as SAMPLE_UNIT_UOM,
null as SAMPLES_STORED_QTY,
null as SAMPLE_STORED_QTY_UOM,
null as CONCENTRATION_QTY,
null as CONCENTRATION_QTY_UOM,
null as SAMPLE_LABELED_BY,
null as COMMENT_TXT,
SYSTIMESTAMP as CREATE_TS,
'BODS_LOAD' as CREATE_BY_ID,
SYSTIMESTAMP as UPDATE_TS,
'BODS_LOAD' as UPDATE_BY_ID
from ETL_STAGE.QCSAMPLE_INV_EXCEL_WB e
inner join QCSAMPLE.SAMPLE_SOURCE ss on 'QC_DRIVE' || e.QC_MASTER_LOT_ID = ss.SAMPLE_SOURCE_ID 
inner join QCSAMPLE.MASTER_LOT ml on ml.SAMPLE_SOURCE_IID = ss.SAMPLE_SOURCE_IID  and lpad(e.QC_MASTER_LOT_ID, 6, '0') = ml.MASTER_LOT_ID
inner join ETL_STAGE.QCSAMPLE_INV_SYBASE_QC_DID qcdid on e.QC_MASTER_LOT_ID = cast(replace(qcdid.QC_DID,'QC', '') as number)
where e.ORIGINAL_FILTER_PAPER is not null;

commit;
